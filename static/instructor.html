<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>êµìˆ˜ìš© ì¶œì„ ê´€ë¦¬</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold">ğŸ“Š ì¶œì„ ë¦¬í¬íŠ¸</h2>
            <button onclick="logout()" class="btn btn-secondary">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white py-3">
                <h5 class="m-0 fw-bold text-primary" id="courseTitle">ê°•ì˜ ë¡œë”© ì¤‘...</h5>
            </div>
            <div class="card-body">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>ì´ë¦„</th>
                            <th>ì´ ìˆ˜ì—…</th>
                            <th>ì¶œì„(ê³µê²°)</th>
                            <th>ì¶œì„ë¥ </th>
                            <th>ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody id="studentList">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const COURSE_ID = 1; // 1ë²ˆ ê°•ì˜ ê¸°ì¤€

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // ë¦¬í¬íŠ¸ API í˜¸ì¶œ (PDF source: 64, 65)
                const res = await fetch(`/courses/${COURSE_ID}/report`);
                
                if (res.ok) {
                    const data = await res.json();
                    document.getElementById('courseTitle').textContent = data.course_title;
                    
                    const tbody = document.getElementById('studentList');
                    data.reports.forEach(r => {
                        // ì¶œì„ë¥ ì— ë”°ë¥¸ ìƒ‰ìƒ êµ¬ë¶„ (ìœ„í—˜êµ° í‘œì‹œ)
                        let badgeClass = "bg-success";
                        let statusText = "ì •ìƒ";
                        if (r.attendance_rate < 70) { 
                            badgeClass = "bg-danger"; 
                            statusText = "ìœ„í—˜"; 
                        } else if (r.attendance_rate < 90) { 
                            badgeClass = "bg-warning text-dark"; 
                            statusText = "ê²½ê³ "; 
                        }

                        tbody.innerHTML += `
                            <tr>
                                <td class="fw-bold">${r.student_name}</td>
                                <td>${r.total_sessions}íšŒ</td>
                                <td>${r.attended_count}íšŒ</td>
                                <td class="fw-bold">${r.attendance_rate}%</td>
                                <td><span class="badge ${badgeClass}">${statusText}</span></td>
                            </tr>
                        `;
                    });
                } else {
                    alert("êµìˆ˜ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.");
                    window.location.href = '/';
                }
            } catch (e) {
                console.error(e);
            }
        });

        async function logout() {
            await fetch('/auth/logout', { method: 'POST' });
            window.location.href = '/';
        }
    </script>
</body>
</html>